<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>57.0</apiVersion>
    <assignments>
        <name>AddContainertype01</name>
        <label>Add Container type 01</label>
        <locationX>880</locationX>
        <locationY>748</locationY>
        <assignmentItems>
            <assignToReference>ContainerType01</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopThroughJustCheckCollection</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>LoopThroughJustCheckCollection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AddContainertype02</name>
        <label>Add Container type 02</label>
        <locationX>861</locationX>
        <locationY>1066</locationY>
        <assignmentItems>
            <assignToReference>ContainerType02</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopThroughJustCheckCollection</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>LoopThroughJustCheckCollection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AddContainertype03</name>
        <label>Add Container type 03</label>
        <locationX>862</locationX>
        <locationY>1362</locationY>
        <assignmentItems>
            <assignToReference>ContainerType03</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopThroughJustCheckCollection</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>LoopThroughJustCheckCollection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>CheckContainerType</name>
        <label>Check Container Type</label>
        <locationX>1039</locationX>
        <locationY>647</locationY>
        <assignmentItems>
            <assignToReference>CheckExistential</assignToReference>
            <operator>RemoveAll</operator>
            <value>
                <elementReference>Loopthroughcheckposition.Container_Type__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CheckExistential</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loopthroughcheckposition.Container_Type__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loopthroughcheckposition</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>CountContainerType01</name>
        <label>CountContainerType01</label>
        <locationX>207</locationX>
        <locationY>646</locationY>
        <assignmentItems>
            <assignToReference>NumberOfCNTR01</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CountConsolCNTR</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>CountContainerType02</name>
        <label>CountContainerType02</label>
        <locationX>49</locationX>
        <locationY>870</locationY>
        <assignmentItems>
            <assignToReference>NumberOfCNTR02</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CountConsolCNTR</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>CountContainertype03</name>
        <label>CountContainertype03</label>
        <locationX>208</locationX>
        <locationY>1055</locationY>
        <assignmentItems>
            <assignToReference>NumberOfCNTR03</assignToReference>
            <operator>Add</operator>
            <value>
                <numberValue>1.0</numberValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CountConsolCNTR</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_AS_recordtype</name>
        <label>Check AS recordtype?</label>
        <locationX>870</locationX>
        <locationY>433</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>ConsolGroupLCL</name>
            <conditionLogic>1 OR (2 AND 3)</conditionLogic>
            <conditions>
                <leftValueReference>Get_Advanced_Shipment_record.RecordType.DeveloperName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Consol</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Advanced_Shipment_record.RecordType.DeveloperName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Group</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Advanced_Shipment_record.Shipment_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>LCL</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_all_Consol_CNTRs</targetReference>
            </connector>
            <label>Consol &amp; Group (LCL)</label>
        </rules>
    </decisions>
    <decisions>
        <name>CheckIfTestNotNull</name>
        <label>CheckIfTestNotNull</label>
        <locationX>1183</locationX>
        <locationY>868</locationY>
        <defaultConnector>
            <targetReference>CheckIfTestNotNull02</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ContainerType01</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AddContainertype01</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>CheckIfTestNotNull02</name>
        <label>CheckIfTestNotNull02</label>
        <locationX>1184</locationX>
        <locationY>1178</locationY>
        <defaultConnector>
            <targetReference>CheckIfTestNotNull03</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Equal_Container_Type_02</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ContainerType02</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AddContainertype02</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>CheckIfTestNotNull03</name>
        <label>CheckIfTestNotNull03</label>
        <locationX>1187</locationX>
        <locationY>1538</locationY>
        <defaultConnector>
            <targetReference>LoopThroughJustCheckCollection</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Container_Type_03</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ContainerType03</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AddContainertype03</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>CountConsol</name>
        <label>CountConsol</label>
        <locationX>196</locationX>
        <locationY>874</locationY>
        <defaultConnector>
            <targetReference>CountConsolCNTR</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Type1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CountConsolCNTR.Container_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>ContainerType01</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CountContainerType01</targetReference>
            </connector>
            <label>Type1</label>
        </rules>
        <rules>
            <name>Type2</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CountConsolCNTR.Container_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>ContainerType02</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CountContainerType02</targetReference>
            </connector>
            <label>Type2</label>
        </rules>
        <rules>
            <name>Type3</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CountConsolCNTR.Container_Type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>ContainerType03</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CountContainertype03</targetReference>
            </connector>
            <label>Type3</label>
        </rules>
    </decisions>
    <description>Add more condition for AS: Group</description>
    <environments>Default</environments>
    <formulas>
        <name>CNTRFormula</name>
        <dataType>String</dataType>
        <expression>TEXT({!$Record.Container_Type__c})</expression>
    </formulas>
    <interviewLabel>Consol CNTR| Count the number of Consol CNTRs with container types when a record is created/Update {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Consol CNTR| Count the number of Consol CNTRs with container types when a record is deleted</label>
    <loops>
        <name>CountConsolCNTR</name>
        <label>CountConsolCNTR</label>
        <locationX>470</locationX>
        <locationY>864</locationY>
        <collectionReference>Get_all_Consol_CNTRs</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>CountConsol</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Update_current_AS_record</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loopthroughcheckposition</name>
        <label>Loop through check position</label>
        <locationX>730</locationX>
        <locationY>647</locationY>
        <collectionReference>Get_all_Consol_CNTRs</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>CheckContainerType</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>LoopThroughJustCheckCollection</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>LoopThroughJustCheckCollection</name>
        <label>LoopThroughJustCheckCollection</label>
        <locationX>725</locationX>
        <locationY>866</locationY>
        <collectionReference>CheckExistential</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>CheckIfTestNotNull</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>CountConsolCNTR</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_Advanced_Shipment_record</name>
        <label>Get Advanced Shipment record</label>
        <locationX>728</locationX>
        <locationY>359</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_AS_recordtype</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.AdvancedShipment__r.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>AdvancedShipment__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_all_Consol_CNTRs</name>
        <label>Get all Consol CNTRs</label>
        <locationX>730</locationX>
        <locationY>500</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loopthroughcheckposition</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>AdvancedShipment__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.AdvancedShipment__r.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Id</field>
            <operator>NotEqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ConsolCNTR__c</object>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_current_AS_record</name>
        <label>Update current AS record</label>
        <locationX>501</locationX>
        <locationY>1366</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Advanced_Shipment_record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Container_Qnty_1__c</field>
            <value>
                <elementReference>NumberOfCNTR01</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Container_Qnty_2__c</field>
            <value>
                <elementReference>NumberOfCNTR02</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Container_Qnty_3__c</field>
            <value>
                <elementReference>NumberOfCNTR03</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Container_Type_1__c</field>
            <value>
                <elementReference>ContainerType01</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Container_Type_2__c</field>
            <value>
                <elementReference>ContainerType02</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Container_Type_3__c</field>
            <value>
                <elementReference>ContainerType03</elementReference>
            </value>
        </inputAssignments>
        <object>AdvancedShipment__c</object>
    </recordUpdates>
    <start>
        <locationX>650</locationX>
        <locationY>49</locationY>
        <connector>
            <targetReference>Get_Advanced_Shipment_record</targetReference>
        </connector>
        <filterLogic>or</filterLogic>
        <filters>
            <field>AdvancedShipment__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <object>ConsolCNTR__c</object>
        <recordTriggerType>Delete</recordTriggerType>
        <triggerType>RecordBeforeDelete</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <name>CheckExistential</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ContainerType01</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ContainerType02</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ContainerType03</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>CurrentCNTRType</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>NumberOfCNTR01</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>NumberOfCNTR02</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>NumberOfCNTR03</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
</Flow>
