<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>59.0</apiVersion>
    <assignments>
        <name>AssignNumberofBilling</name>
        <label>Assign Number of Billing</label>
        <locationX>176</locationX>
        <locationY>863</locationY>
        <assignmentItems>
            <assignToReference>VarNCount_SellingBilling</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>CurrencySellingnotnull</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>VarNCount_BuyingBilling</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>CurrencyBuyingnotnull</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>VarNCount_SellingBillingReceived</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>PaymentConfirmedSellingTrue</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>VarNCount_BuyingBillingPaid</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>PaymentConfirmedBuyingTrue</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>PaymentConfirmedSellingFalse</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignSOValue</name>
        <label>Assign SO Value</label>
        <locationX>264</locationX>
        <locationY>1487</locationY>
        <assignmentItems>
            <assignToReference>TotalAmountofSellingUSD</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopallrelatedConsolBills.TotalAmountofSellingFCY__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TotalAmountofSellingVND</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopallrelatedConsolBills.TotalAmountofSellingLocal__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TotalAmountofBuyingUSD</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopallrelatedConsolBills.TotalAmountofBuyingFCY__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TotalAmountofBuyingVND</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopallrelatedConsolBills.TotalAmountofBuyingLocal__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TotalSellingInclTaxUSD</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopallrelatedConsolBills.Total_Selling_Incl_Tax_FCY__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TotalSellingInclTaxVND</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopallrelatedConsolBills.Total_Selling_Incl_Tax_Local__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TotalBuyingInclTaxUSD</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopallrelatedConsolBills.TotalBuyingInclTaxFCY__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TotalBuyingInclTaxVND</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopallrelatedConsolBills.TotalBuyingInclTaxLocal__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>LoopallrelatedConsolBills</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignTotalUnreceivedBalance</name>
        <label>Assign Total Unreceived Balance</label>
        <locationX>264</locationX>
        <locationY>1187</locationY>
        <assignmentItems>
            <assignToReference>TotalUnreceivedBalanceUSD</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopPaymentConfirmedSellingFalse.Total_Selling_Incl_Tax_FCY__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>TotalUnreceivedBalanceVND</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopPaymentConfirmedSellingFalse.Total_Selling_Incl_Tax_Local__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>LoopPaymentConfirmedSellingFalse</targetReference>
        </connector>
    </assignments>
    <collectionProcessors>
        <name>CurrencyBuyingnotnull</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Currency Buying not null</label>
        <locationX>176</locationX>
        <locationY>539</locationY>
        <assignNextValueToReference>currentItem_CurrencyBuyingnotnull</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>GetallrelatedConsolBills</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_CurrencyBuyingnotnull.CurrencyBuying__c</leftValueReference>
            <operator>IsNull</operator>
            <rightValue>
                <booleanValue>false</booleanValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>PaymentConfirmedSellingTrue</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>CurrencySellingnotnull</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Currency Selling not null</label>
        <locationX>176</locationX>
        <locationY>431</locationY>
        <assignNextValueToReference>currentItem_CurrencyBuyingnotnull</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>GetallrelatedConsolBills</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_CurrencyBuyingnotnull.CurrencySelling__c</leftValueReference>
            <operator>IsNull</operator>
            <rightValue>
                <booleanValue>false</booleanValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>CurrencyBuyingnotnull</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>PaymentConfirmedBuyingTrue</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Payment Confirmed-Buying = True</label>
        <locationX>176</locationX>
        <locationY>755</locationY>
        <assignNextValueToReference>currentItem_PaymentConfirmedSellingFalse</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>GetallrelatedConsolBills</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_PaymentConfirmedSellingFalse.PaymentConfirmedBuying__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <booleanValue>true</booleanValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>AssignNumberofBilling</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>PaymentConfirmedSellingFalse</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Payment Confirmed-Selling = False</label>
        <locationX>176</locationX>
        <locationY>971</locationY>
        <assignNextValueToReference>currentItem_PaymentConfirmedSellingFalse</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>GetallrelatedConsolBills</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_PaymentConfirmedSellingFalse.PaymentConfirmedSelling__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <booleanValue>false</booleanValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>LoopPaymentConfirmedSellingFalse</targetReference>
        </connector>
    </collectionProcessors>
    <collectionProcessors>
        <name>PaymentConfirmedSellingTrue</name>
        <elementSubtype>FilterCollectionProcessor</elementSubtype>
        <label>Payment Confirmed-Selling = True</label>
        <locationX>176</locationX>
        <locationY>647</locationY>
        <assignNextValueToReference>currentItem_PaymentConfirmedSellingFalse</assignNextValueToReference>
        <collectionProcessorType>FilterCollectionProcessor</collectionProcessorType>
        <collectionReference>GetallrelatedConsolBills</collectionReference>
        <conditionLogic>and</conditionLogic>
        <conditions>
            <leftValueReference>currentItem_PaymentConfirmedSellingFalse.PaymentConfirmedSelling__c</leftValueReference>
            <operator>EqualTo</operator>
            <rightValue>
                <booleanValue>true</booleanValue>
            </rightValue>
        </conditions>
        <connector>
            <targetReference>PaymentConfirmedBuyingTrue</targetReference>
        </connector>
    </collectionProcessors>
    <environments>Default</environments>
    <interviewLabel>Consol Bill | Trigger flow to update F/TMS S/O when a Consol Bill is updated {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Consol Bill | Trigger flow to update F/TMS S/O when a Consol Bill is updated</label>
    <loops>
        <name>LoopallrelatedConsolBills</name>
        <label>Loop all related Consol Bills</label>
        <locationX>176</locationX>
        <locationY>1379</locationY>
        <collectionReference>GetallrelatedConsolBills</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>AssignSOValue</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>UpdateFTMSSO</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>LoopPaymentConfirmedSellingFalse</name>
        <label>Loop Payment Confirmed-Selling = False</label>
        <locationX>176</locationX>
        <locationY>1079</locationY>
        <collectionReference>PaymentConfirmedSellingFalse</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>AssignTotalUnreceivedBalance</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>LoopallrelatedConsolBills</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>GetallrelatedConsolBills</name>
        <label>Get all related Consol Bills</label>
        <locationX>176</locationX>
        <locationY>323</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>CurrencySellingnotnull</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>FTMSSO__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.FTMSSO__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>ConsolidationShipmentName__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.ConsolidationShipmentName__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ConsolBill__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>UpdateFTMSSO</name>
        <label>Update F/TMS S/O</label>
        <locationX>176</locationX>
        <locationY>1679</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.FTMSSO__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>BuyingBillPaid__c</field>
            <value>
                <elementReference>VarNCount_BuyingBillingPaid</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>NumberofBuyingBilling__c</field>
            <value>
                <elementReference>VarNCount_BuyingBilling</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>NumberofSellingBilling__c</field>
            <value>
                <elementReference>VarNCount_SellingBilling</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SellingBillReceived__c</field>
            <value>
                <elementReference>VarNCount_SellingBillingReceived</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TotalAmountofBuyingUSD__c</field>
            <value>
                <elementReference>TotalAmountofBuyingUSD</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TotalAmountofBuyingVND__c</field>
            <value>
                <elementReference>TotalAmountofBuyingVND</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TotalAmountofSellingUSD__c</field>
            <value>
                <elementReference>TotalAmountofSellingUSD</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TotalAmountofSellingVND__c</field>
            <value>
                <elementReference>TotalAmountofSellingVND</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TotalBuyingInclTaxUSD__c</field>
            <value>
                <elementReference>TotalBuyingInclTaxUSD</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TotalBuyingInclTaxVND__c</field>
            <value>
                <elementReference>TotalBuyingInclTaxVND</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TotalSellingInclTaxUSD__c</field>
            <value>
                <elementReference>TotalSellingInclTaxUSD</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TotalSellingInclTaxVND__c</field>
            <value>
                <elementReference>TotalSellingInclTaxVND</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TotalUnreceivedBalanceUSD__c</field>
            <value>
                <elementReference>TotalUnreceivedBalanceUSD</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>TotalUnreceivedBalanceVND__c</field>
            <value>
                <elementReference>TotalUnreceivedBalanceVND</elementReference>
            </value>
        </inputAssignments>
        <object>FTMSSO__c</object>
    </recordUpdates>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>GetallrelatedConsolBills</targetReference>
        </connector>
        <filterLogic>1 AND ( 2 OR 3 OR 4 OR 5 OR 6 OR 7 OR 8 OR 9 OR 10 OR 11 OR 12 OR 13 OR 14 OR 15 OR 16)</filterLogic>
        <filters>
            <field>FTMSSO__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Quantity__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>ExchangeRateSelling__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>ExchangeRateSellingUSD__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>ExchangeRateBuying__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>ExchangeRateBuyingUSD__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>TaxRatioSelling__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>TaxRatioBuying__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>UnitPriceofSellingActual__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>UnitPriceofSellingFCY__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>UnitPriceofSellingLocal__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>UnitPriceofBuyingActual__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>UnitPriceofBuyingFCY__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>UnitPriceofBuyingLocal__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Tax_Included__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>Tax_Included_Selling__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>ConsolBill__c</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Obsolete</status>
    <variables>
        <name>currentItem_CurrencyBuyingnotnull</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ConsolBill__c</objectType>
    </variables>
    <variables>
        <name>currentItem_PaymentConfirmedSellingFalse</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ConsolBill__c</objectType>
    </variables>
    <variables>
        <name>ProfitInclTaxUSD</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>3</scale>
    </variables>
    <variables>
        <name>ProfitInclTaxVND</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>ProfitNICTaxUSD</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>3</scale>
    </variables>
    <variables>
        <name>ProfitNICTaxVND</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>TotalAmountofBuyingUSD</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>3</scale>
    </variables>
    <variables>
        <name>TotalAmountofBuyingVND</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>TotalAmountofSellingUSD</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>3</scale>
    </variables>
    <variables>
        <name>TotalAmountofSellingVND</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>TotalBuyingInclTaxUSD</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>3</scale>
    </variables>
    <variables>
        <name>TotalBuyingInclTaxVND</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>TotalSellingInclTaxUSD</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>3</scale>
    </variables>
    <variables>
        <name>TotalSellingInclTaxVND</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>TotalUnreceivedBalanceUSD</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>3</scale>
    </variables>
    <variables>
        <name>TotalUnreceivedBalanceVND</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>VarNCount_BuyingBilling</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>VarNCount_BuyingBillingPaid</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>VarNCount_SellingBilling</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>VarNCount_SellingBillingReceived</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
</Flow>
