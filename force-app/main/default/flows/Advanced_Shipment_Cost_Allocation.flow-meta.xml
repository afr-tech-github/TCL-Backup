<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>AllocateFailed</name>
        <label>Allocate Failed</label>
        <locationX>725</locationX>
        <locationY>1404</locationY>
        <actionName>c:showToast</actionName>
        <actionType>component</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>type</name>
            <value>
                <stringValue>error</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>****ERROR MESSAGE****</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>message</name>
            <value>
                <stringValue>Allocation for Advanced Shipment failed!</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>duration</name>
            <value>
                <stringValue>5</stringValue>
            </value>
        </inputParameters>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <actionCalls>
        <name>Show_Error</name>
        <label>Show Error</label>
        <locationX>1676</locationX>
        <locationY>767</locationY>
        <actionName>c:showToast</actionName>
        <actionType>component</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>type</name>
            <value>
                <stringValue>error</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>****ERROR MESSAGE****</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>message</name>
            <value>
                <stringValue>Sorry! Avanced Shipment has no Consol Bills!</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>duration</name>
            <value>
                <stringValue>5</stringValue>
            </value>
        </inputParameters>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <actionCalls>
        <name>Successfully</name>
        <label>Successfully</label>
        <locationX>888</locationX>
        <locationY>1397</locationY>
        <actionName>c:showToast</actionName>
        <actionType>component</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>type</name>
            <value>
                <stringValue>success</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>****SUCCESS MESSAGE****</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>message</name>
            <value>
                <stringValue>Cost allocation for AS: {url} is successfully!</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>duration</name>
            <value>
                <stringValue>5</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>urlLink</name>
            <value>
                <elementReference>URL</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>urlLabel</name>
            <value>
                <elementReference>GetAdvancedShipment.Name</elementReference>
            </value>
        </inputParameters>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <actionCalls>
        <name>ToastErrorMessagewhenSOLocked</name>
        <label>Toast Error Message when SO Locked</label>
        <locationX>1675</locationX>
        <locationY>586</locationY>
        <actionName>c:showToast</actionName>
        <actionType>component</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>type</name>
            <value>
                <stringValue>error</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>title</name>
            <value>
                <stringValue>****ERROR MESSAGE****</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>message</name>
            <value>
                <stringValue>Sorry! Shipments belonging to this record have been locked! Please try again!</stringValue>
            </value>
        </inputParameters>
        <inputParameters>
            <name>duration</name>
            <value>
                <stringValue>5</stringValue>
            </value>
        </inputParameters>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <apiVersion>57.0</apiVersion>
    <assignments>
        <name>Add_IDs_to_collection</name>
        <label>Add IDs to collection</label>
        <locationX>1091</locationX>
        <locationY>483</locationY>
        <assignmentItems>
            <assignToReference>ShipmentIDs</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopthroughSO.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>LoopthroughSO</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AddBillingsandSOIdtocollection</name>
        <label>Add Billings and SO Id to collection</label>
        <locationX>1590</locationX>
        <locationY>1127</locationY>
        <assignmentItems>
            <assignToReference>BillCollectionTocheck</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>CheckBillingsinConsolBills</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ShipmentIDsUpdate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>CheckBillingsinConsolBills.FTMSSO__r.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CheckBillingsinConsolBills</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_values_from_Consol_Bill_to_variables</name>
        <label>Assign values from Consol Bill to variables</label>
        <locationX>1059</locationX>
        <locationY>1089</locationY>
        <assignmentItems>
            <assignToReference>varUnitPriceofBuyingLOCAL</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.UnitPriceofBuyingLocal__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varUnitPriceofBuyingFCY</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.UnitPriceofBuyingFCY__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ConsolBillChargeUnit</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.ChargeUnit__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CheckBillingsinConsolBills</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignvalueforIndividualrecord_Update</name>
        <label>Assign value for Individual record</label>
        <locationX>1804</locationX>
        <locationY>1168</locationY>
        <assignmentItems>
            <assignToReference>ThroughConsolBills.UnitPriceofBuyingLocal__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>UnitPriceofBuyingFormulaLocal</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LoopthroughBillstoUpdate.ChargeQuantity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ChargeQuantityFormula</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LoopthroughBillstoUpdate.UnitPriceofBuyingFCY__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>UnitPriceOfBuyingFormulaFCY</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LoopthroughBillstoUpdate.ChargeUnit__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.ChargeUnit__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LoopthroughBillstoUpdate.PaymentTo__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.PaymentTo__r.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LoopthroughBillstoUpdate.Service__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.PricingName__r.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LoopthroughBillstoUpdate.TaxRateBuying__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.TaxRatioBuying__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LoopthroughBillstoUpdate.CurrencyBuying__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.Currency__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CollectionBillsToUpdate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LoopthroughBillstoUpdate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>LoopthroughBillstoUpdate</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>AssignvalueforIndividualrecordToUpdate</name>
        <label>Assign value for Individual record (To Update)</label>
        <locationX>2116</locationX>
        <locationY>760</locationY>
        <assignmentItems>
            <assignToReference>SingleBillRecord.Service__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.PricingName__r.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.UnitPriceofBuyingLocal__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>UnitPriceofBuyingFormulaLocal</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.ChargeQuantity__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ChargeQuantityFormula</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.UnitPriceofBuyingFCY__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>UnitPriceOfBuyingFormulaFCY</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.FTMSSO__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>LoopthroughSOUpdate.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.ChargeUnit__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.ChargeUnit__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.ConsolBill__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.PaymentTo__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.PaymentTo__r.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.TaxRateBuying__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.TaxRatioBuying__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.CurrencyBuying__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ThroughConsolBills.Currency__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CollectionBillsToCreate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>SingleBillRecord</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Removelastvalues_0_0</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Remove_all_Records</name>
        <label>Remove all Records</label>
        <locationX>1217</locationX>
        <locationY>894</locationY>
        <assignmentItems>
            <assignToReference>BillCollectionTocheck</assignToReference>
            <operator>RemoveAll</operator>
            <value>
                <elementReference>BillCollectionTocheck</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ShipmentIDsUpdate</assignToReference>
            <operator>RemoveAll</operator>
            <value>
                <elementReference>ShipmentIDsUpdate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varUnitPriceofBuyingLOCAL</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>varUnitPriceofBuyingFCY</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>ConsolBillChargeUnit</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <connector>
            <targetReference>ThroughConsolBills</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Removelastvalues_0_0</name>
        <label>Remove last values</label>
        <locationX>1792</locationX>
        <locationY>760</locationY>
        <assignmentItems>
            <assignToReference>SingleBillRecord.PaymentTo__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.Service__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.UnitPriceofBuyingLocal__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.ChargeQuantity__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.UnitPriceofBuyingFCY__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.FTMSSO__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.ChargeUnit__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.Id</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.TaxRateBuying__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>SingleBillRecord.CurrencyBuying__c</assignToReference>
            <operator>Assign</operator>
        </assignmentItems>
        <connector>
            <targetReference>LoopthroughSOUpdate</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_Shipment</name>
        <label>Check Shipment</label>
        <locationX>2111</locationX>
        <locationY>925</locationY>
        <defaultConnector>
            <targetReference>AssignvalueforIndividualrecordToUpdate</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not In</defaultConnectorLabel>
        <rules>
            <name>In_collection</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>ShipmentIDsUpdate</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>LoopthroughSOUpdate.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>LoopthroughBillstoUpdate</targetReference>
            </connector>
            <label>In collection</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_Shipment_In_Billing</name>
        <label>Check Shipment In Billing</label>
        <locationX>2118</locationX>
        <locationY>1319</locationY>
        <defaultConnector>
            <targetReference>LoopthroughBillstoUpdate</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not in Billing</defaultConnectorLabel>
        <rules>
            <name>Shipment_In_Billing</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>LoopthroughSOUpdate.Id</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>LoopthroughBillstoUpdate.FTMSSO__r.Id</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>ShipmentIDsUpdate</leftValueReference>
                <operator>Contains</operator>
                <rightValue>
                    <elementReference>LoopthroughSOUpdate.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AssignvalueforIndividualrecord_Update</targetReference>
            </connector>
            <label>Shipment In Billing</label>
        </rules>
    </decisions>
    <decisions>
        <name>CheckindividualBill</name>
        <label>Check individual Bill</label>
        <locationX>1313</locationX>
        <locationY>1238</locationY>
        <defaultConnector>
            <targetReference>CheckBillingsinConsolBills</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not in</defaultConnectorLabel>
        <rules>
            <name>In_Consol_Bill</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CheckBillingsinConsolBills.ConsolBill__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>ThroughConsolBills.Id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>AddBillingsandSOIdtocollection</targetReference>
            </connector>
            <label>In Consol Bill</label>
        </rules>
    </decisions>
    <decisions>
        <name>HaveBillingsorNot</name>
        <label>Have Billings or Not</label>
        <locationX>1384</locationX>
        <locationY>685</locationY>
        <defaultConnector>
            <targetReference>Show_Error</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No Consol bill return</defaultConnectorLabel>
        <rules>
            <name>Yes_have</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetallConsolBillsinAdvancedShipment</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetallLockShipmentsinAdvancedShipment</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetallShipmentinAdvancedShipment</targetReference>
            </connector>
            <label>Yes have</label>
        </rules>
        <rules>
            <name>Have_shipment_has_been_locked</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetallLockShipmentsinAdvancedShipment</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>GetallConsolBillsinAdvancedShipment</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>ToastErrorMessagewhenSOLocked</targetReference>
            </connector>
            <label>Have shipment has been locked</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <formulas>
        <name>ChargeQuantityFormula</name>
        <dataType>Number</dataType>
        <expression>CASE({!ConsolBillChargeUnit},&quot;CBM&quot;,{!LoopthroughSOUpdate.MeasurementTotalCBM__c},
							 &quot;Container&quot;,{!LoopthroughSOUpdate.MeasurementTotalCBM__c},
							  &quot;Kg&quot;,{!LoopthroughSOUpdate.GrossWeight__c},1)</expression>
        <scale>0</scale>
    </formulas>
    <formulas>
        <name>UnitPriceofBuyingFor</name>
        <dataType>Number</dataType>
        <expression>CASE({!ThroughConsolBills.Currency__c}, &apos;VND&apos;,{!varUnitPriceofBuyingLOCAL}, {!varUnitPriceofBuyingFCY})</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>UnitPriceofBuyingFormula</name>
        <dataType>Number</dataType>
        <expression>IF(
    ISPICKVAL({!ThroughConsolBills.Currency__c}, &quot;VND&quot;),
    {!varUnitPriceofBuyingLOCAL},
    {!varUnitPriceofBuyingFCY}
)/
CASE({!ConsolBillChargeUnit},
	&quot;CBM&quot;,1,
	&quot;Kg&quot;,1,
	&quot;Container&quot;,1,
	IF(ISBLANK({!GetAdvancedShipment.Number_of_House_BL__c}),1,{!GetAdvancedShipment.Number_of_House_BL__c}))</expression>
        <scale>3</scale>
    </formulas>
    <formulas>
        <name>UnitPriceOfBuyingFormulaFCY</name>
        <dataType>Number</dataType>
        <expression>IF(ISPICKVAL({!ThroughConsolBills.Currency__c},&quot;VND&quot;),NULL,{!UnitPriceofBuyingFormula})</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>UnitPriceofBuyingFormulaLocal</name>
        <dataType>Number</dataType>
        <expression>IF(ISPICKVAL({!ThroughConsolBills.Currency__c},&quot;VND&quot;),{!UnitPriceofBuyingFormula},NULL)</expression>
        <scale>2</scale>
    </formulas>
    <formulas>
        <name>URL</name>
        <dataType>String</dataType>
        <expression>LEFT({!$Api.Partner_Server_URL_450}, FIND(&apos;/services&apos;, {!$Api.Partner_Server_URL_450})) + CASESAFEID({!GetAdvancedShipment.Id})</expression>
    </formulas>
    <interviewLabel>Advanced Shipment| Cost Allocation {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Advanced Shipment| Cost Allocation</label>
    <loops>
        <name>CheckBillingsinConsolBills</name>
        <label>Check Billings in Consol Bills</label>
        <locationX>1323</locationX>
        <locationY>1006</locationY>
        <collectionReference>Get_all_Bills_in_Shipment</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>CheckindividualBill</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>LoopthroughSOUpdate</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>LoopthroughBillstoUpdate</name>
        <label>Loop through Bills to Update</label>
        <locationX>2128</locationX>
        <locationY>1122</locationY>
        <collectionReference>BillCollectionTocheck</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Check_Shipment_In_Billing</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>LoopthroughSOUpdate</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>LoopthroughSO</name>
        <label>Loop through SO</label>
        <locationX>1089</locationX>
        <locationY>679</locationY>
        <collectionReference>GetallShipmentinAdvancedShipment</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Add_IDs_to_collection</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_all_Bills_in_Shipment</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>LoopthroughSOUpdate</name>
        <label>Loop through SO (To update)</label>
        <locationX>1784</locationX>
        <locationY>960</locationY>
        <collectionReference>GetallShipmentinAdvancedShipment</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Check_Shipment</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Remove_all_Records</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>ThroughConsolBills</name>
        <label>Through Consol Bills</label>
        <locationX>1059</locationX>
        <locationY>893</locationY>
        <collectionReference>GetallConsolBillsinAdvancedShipment</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_values_from_Consol_Bill_to_variables</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>CreateFTMSBills_0</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>FREE_FORM_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <name>CreateFTMSBills_0</name>
        <label>Create F/TMS Bills</label>
        <locationX>817</locationX>
        <locationY>1038</locationY>
        <connector>
            <targetReference>Update_Bills</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Rollback_if_failed</targetReference>
        </faultConnector>
        <inputReference>CollectionBillsToCreate</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_all_Bills_in_Shipment</name>
        <label>Get all Bills in Shipment</label>
        <locationX>926</locationX>
        <locationY>676</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>ThroughConsolBills</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>FTMSSO__c</field>
            <operator>In</operator>
            <value>
                <elementReference>ShipmentIDs</elementReference>
            </value>
        </filters>
        <filters>
            <field>ConsolBill__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>FTMSBill__c</object>
        <sortField>Name</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetAdvancedShipment</name>
        <label>Get Advanced Shipment</label>
        <locationX>1783</locationX>
        <locationY>229</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Screen_Input</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>AdvancedShipment__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetallConsolBillsinAdvancedShipment</name>
        <label>Get all Consol Bills in Advanced Shipment</label>
        <locationX>1387</locationX>
        <locationY>446</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>HaveBillingsorNot</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ConsolidationShipmentName__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>GetAdvancedShipment.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ConsolBill__c</object>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetallLockShipmentsinAdvancedShipment</name>
        <label>Get all Lock Shipments in Advanced Shipment</label>
        <locationX>1558</locationX>
        <locationY>446</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>GetallConsolBillsinAdvancedShipment</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ConsolidationID__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>GetAdvancedShipment.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Lock_SO__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>FTMSSO__c</object>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetallShipmentinAdvancedShipment</name>
        <label>Get all Shipments in Advanced Shipment</label>
        <locationX>1225</locationX>
        <locationY>680</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>LoopthroughSO</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ConsolidationID__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>GetAdvancedShipment.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>FTMSSO__c</object>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordRollbacks>
        <name>Rollback_if_failed</name>
        <label>Rollback if failed</label>
        <locationX>724</locationX>
        <locationY>1236</locationY>
        <connector>
            <targetReference>AllocateFailed</targetReference>
        </connector>
    </recordRollbacks>
    <recordUpdates>
        <name>Update_Bills</name>
        <label>Update Bills</label>
        <locationX>890</locationX>
        <locationY>1233</locationY>
        <connector>
            <targetReference>Successfully</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Rollback_if_failed</targetReference>
        </faultConnector>
        <inputReference>CollectionBillsToUpdate</inputReference>
    </recordUpdates>
    <screens>
        <name>Screen_Input</name>
        <label>Screen Input</label>
        <locationX>1559</locationX>
        <locationY>228</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>GetallLockShipmentsinAdvancedShipment</targetReference>
        </connector>
        <fields>
            <name>header04</name>
            <fieldText>&lt;p style=&quot;text-align: center;&quot;&gt;&lt;span style=&quot;font-size: 16px; color: rgb(0, 0, 0);&quot;&gt;Do you want to allocate the cost for this record: {!GetAdvancedShipment.Name}?&lt;/span&gt;&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <nextOrFinishButtonLabel>Yes</nextOrFinishButtonLabel>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <start>
        <locationX>1657</locationX>
        <locationY>51</locationY>
        <connector>
            <targetReference>GetAdvancedShipment</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>BillCollectionTocheck</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>FTMSBill__c</objectType>
    </variables>
    <variables>
        <name>CollectionBillsToCreate</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>FTMSBill__c</objectType>
    </variables>
    <variables>
        <name>CollectionBillsToUpdate</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>FTMSBill__c</objectType>
    </variables>
    <variables>
        <name>ConsolBillChargeUnit</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>NumberOfBillings</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>NumberOfShipment</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ShipmentIDs</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>ShipmentIDsUpdate</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>SingleBillRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>FTMSBill__c</objectType>
    </variables>
    <variables>
        <name>varUnitPriceofBuyingFCY</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
    <variables>
        <name>varUnitPriceofBuyingLOCAL</name>
        <dataType>Currency</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>2</scale>
    </variables>
</Flow>
